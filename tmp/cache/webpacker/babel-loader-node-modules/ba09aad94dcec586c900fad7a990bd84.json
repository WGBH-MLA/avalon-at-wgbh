{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = exports.PureTimespanForm = void 0;\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));\n\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _reactBootstrap = require(\"react-bootstrap\");\n\nvar _reactRedux = require(\"react-redux\");\n\nvar _StructuralMetadataUtils = _interopRequireDefault(require(\"../services/StructuralMetadataUtils\"));\n\nvar _formHelper = require(\"../services/form-helper\");\n\nvar peaksActions = _interopRequireWildcard(require(\"../actions/peaks-instance\"));\n\nvar _WaveformDataUtils = _interopRequireDefault(require(\"../services/WaveformDataUtils\"));\n\nvar _lodash = require(\"lodash\");\n\nvar structuralMetadataUtils = new _StructuralMetadataUtils[\"default\"]();\nvar waveformDataUtils = new _WaveformDataUtils[\"default\"]();\n\nvar TimespanForm =\n/*#__PURE__*/\nfunction (_Component) {\n  (0, _inherits2[\"default\"])(TimespanForm, _Component);\n\n  function TimespanForm(props) {\n    var _this;\n\n    (0, _classCallCheck2[\"default\"])(this, TimespanForm);\n    _this = (0, _possibleConstructorReturn2[\"default\"])(this, (0, _getPrototypeOf2[\"default\"])(TimespanForm).call(this, props));\n    (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"buildHeadingsOptions\", function () {\n      var smData = _this.props.smData;\n      var newSpan = {\n        begin: _this.state.beginTime,\n        end: _this.state.endTime\n      }; // Get spans in overall span list which fall before and after the new span\n\n      var wrapperSpans = structuralMetadataUtils.findWrapperSpans(newSpan, _this.allSpans); // Get all valid div headings\n\n      var validHeadings = structuralMetadataUtils.getValidHeadings(wrapperSpans, smData); // Update state with valid headings\n\n      _this.setState({\n        validHeadings: validHeadings\n      });\n    });\n    (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"clearHeadingOptions\", function () {\n      _this.setState({\n        validHeadings: []\n      });\n    });\n    (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"handleInputChange\", function (e) {\n      _this.setState((0, _defineProperty2[\"default\"])({}, e.target.id, e.target.value), _this.updateChildOfOptions());\n    });\n    (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"handleSubmit\", function (e) {\n      e.preventDefault();\n      var _this$state = _this.state,\n          beginTime = _this$state.beginTime,\n          endTime = _this$state.endTime,\n          timespanChildOf = _this$state.timespanChildOf,\n          timespanTitle = _this$state.timespanTitle;\n\n      _this.props.cancelClick();\n\n      _this.props.onSubmit({\n        beginTime: beginTime,\n        endTime: endTime,\n        timespanChildOf: timespanChildOf,\n        timespanTitle: timespanTitle\n      }); // Clear form values\n\n\n      _this.clearFormValues();\n    });\n    (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"handleTimeChange\", function (e) {\n      // Lock setting isTyping to false before updating the DOM\n      _this.props.setIsDragging(_this.props.segment, 0); // Set isTyping flag in props to true\n\n\n      _this.props.setIsTyping(1);\n\n      _this.setState((0, _defineProperty2[\"default\"])({}, e.target.id, e.target.value), function () {\n        _this.updateChildOfOptions(); // Update waveform segment with user inputs in the form\n\n\n        if (_this.localValidTimespans().valid) {\n          _this.props.updateSegment(_this.props.segment, _this.state);\n        }\n      });\n    });\n    (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"handleCancelClick\", function () {\n      _this.props.cancelClick();\n    });\n    (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"handleChildOfChange\", function (e) {\n      _this.setState({\n        timespanChildOf: e.target.value\n      });\n    });\n    _this.state = {\n      beginTime: '',\n      endTime: '',\n      timespanChildOf: '',\n      timespanTitle: '',\n      validHeadings: [],\n      peaksInstance: _this.props.peaksInstance,\n      isInitializing: _this.props.isInitializing\n    };\n    _this.allSpans = null;\n    return _this;\n  }\n\n  (0, _createClass2[\"default\"])(TimespanForm, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var smData = this.props.smData;\n      this.allSpans = structuralMetadataUtils.getItemsOfType('span', smData);\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState) {\n      var smData = this.props.smData;\n\n      if (!(0, _lodash.isEqual)(smData, prevProps.smData)) {\n        this.allSpans = structuralMetadataUtils.getItemsOfType('span', smData); // Update valid headings when structure changes\n\n        this.updateChildOfOptions();\n      }\n\n      var _this$state2 = this.state,\n          beginTime = _this$state2.beginTime,\n          endTime = _this$state2.endTime,\n          isInitializing = _this$state2.isInitializing;\n      var prevBeginTime = prevState.beginTime,\n          prevEndTime = prevState.endTime;\n\n      if (beginTime !== prevBeginTime || endTime !== prevEndTime) {\n        this.updateChildOfOptions();\n\n        if (!isInitializing) {\n          // Set isInitializing flag to false\n          this.props.setIsInitializing(0);\n        }\n      }\n    }\n  }, {\n    key: \"clearFormValues\",\n    value: function clearFormValues() {\n      this.setState({\n        beginTime: '',\n        endTime: '',\n        timespanChildOf: '',\n        timespanTitle: '',\n        validHeadings: []\n      });\n    }\n  }, {\n    key: \"formIsValid\",\n    value: function formIsValid() {\n      var titleValid = (0, _formHelper.isTitleValid)(this.state.timespanTitle);\n      var childOfValid = this.state.timespanChildOf.length > 0;\n      var timesValidResponse = this.localValidTimespans();\n      return titleValid && childOfValid && timesValidResponse.valid;\n    }\n  }, {\n    key: \"updateChildOfOptions\",\n    value: function updateChildOfOptions() {\n      var timesValidResponse = this.localValidTimespans();\n\n      if (timesValidResponse.valid) {\n        this.buildHeadingsOptions();\n      } else {\n        this.clearHeadingOptions();\n      }\n    }\n    /**\n     * A local wrapper for the reusable function 'validTimespans'\n     */\n\n  }, {\n    key: \"localValidTimespans\",\n    value: function localValidTimespans() {\n      var _this$state3 = this.state,\n          beginTime = _this$state3.beginTime,\n          endTime = _this$state3.endTime;\n      var allSpans = this.allSpans;\n      return (0, _formHelper.validTimespans)(beginTime, endTime, allSpans, this.props.peaksInstance.peaks);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$state4 = this.state,\n          beginTime = _this$state4.beginTime,\n          endTime = _this$state4.endTime,\n          timespanChildOf = _this$state4.timespanChildOf,\n          timespanTitle = _this$state4.timespanTitle;\n      return _react[\"default\"].createElement(\"form\", {\n        onSubmit: this.handleSubmit\n      }, _react[\"default\"].createElement(_reactBootstrap.FormGroup, {\n        controlId: \"timespanTitle\",\n        validationState: (0, _formHelper.getValidationTitleState)(timespanTitle)\n      }, _react[\"default\"].createElement(_reactBootstrap.ControlLabel, null, \"Title\"), _react[\"default\"].createElement(_reactBootstrap.FormControl, {\n        type: \"text\",\n        value: timespanTitle,\n        onChange: this.handleInputChange\n      }), _react[\"default\"].createElement(_reactBootstrap.FormControl.Feedback, null)), _react[\"default\"].createElement(_reactBootstrap.Row, null, _react[\"default\"].createElement(_reactBootstrap.Col, {\n        sm: 6\n      }, _react[\"default\"].createElement(_reactBootstrap.FormGroup, {\n        controlId: \"beginTime\",\n        validationState: (0, _formHelper.getValidationBeginState)(beginTime, this.allSpans)\n      }, _react[\"default\"].createElement(_reactBootstrap.ControlLabel, null, \"Begin Time\"), _react[\"default\"].createElement(_reactBootstrap.FormControl, {\n        type: \"text\",\n        value: beginTime,\n        placeholder: \"00:00:00\",\n        onChange: this.handleTimeChange\n      }), _react[\"default\"].createElement(_reactBootstrap.FormControl.Feedback, null))), _react[\"default\"].createElement(_reactBootstrap.Col, {\n        sm: 6\n      }, _react[\"default\"].createElement(_reactBootstrap.FormGroup, {\n        controlId: \"endTime\",\n        validationState: (0, _formHelper.getValidationEndState)(beginTime, endTime, this.allSpans, this.props.peaksInstance.peaks)\n      }, _react[\"default\"].createElement(_reactBootstrap.ControlLabel, null, \"End Time\"), _react[\"default\"].createElement(_reactBootstrap.FormControl, {\n        type: \"text\",\n        value: endTime,\n        placeholder: \"00:00:00\",\n        onChange: this.handleTimeChange\n      }), _react[\"default\"].createElement(_reactBootstrap.FormControl.Feedback, null)))), _react[\"default\"].createElement(_reactBootstrap.FormGroup, {\n        controlId: \"timespanChildOf\"\n      }, _react[\"default\"].createElement(_reactBootstrap.ControlLabel, null, \"Child Of\"), _react[\"default\"].createElement(_reactBootstrap.FormControl, {\n        componentClass: \"select\",\n        placeholder: \"select\",\n        onChange: this.handleChildOfChange,\n        value: timespanChildOf\n      }, _react[\"default\"].createElement(\"option\", {\n        value: \"\"\n      }, \"Select...\"), this.state.validHeadings.map(function (item) {\n        return _react[\"default\"].createElement(\"option\", {\n          value: item.id,\n          key: item.id\n        }, item.label);\n      }))), _react[\"default\"].createElement(_reactBootstrap.Row, null, _react[\"default\"].createElement(_reactBootstrap.Col, {\n        xs: 12\n      }, _react[\"default\"].createElement(_reactBootstrap.ButtonToolbar, {\n        className: \"pull-right\"\n      }, _react[\"default\"].createElement(_reactBootstrap.Button, {\n        onClick: this.handleCancelClick\n      }, \"Cancel\"), _react[\"default\"].createElement(_reactBootstrap.Button, {\n        bsStyle: \"primary\",\n        type: \"submit\",\n        disabled: !this.formIsValid()\n      }, \"Save\")))));\n    }\n  }], [{\n    key: \"getDerivedStateFromProps\",\n    value: function getDerivedStateFromProps(nextProps, prevState) {\n      if (nextProps.timespanOpen && !nextProps.isTyping) {\n        var initSegment = nextProps.initSegment,\n            isInitializing = nextProps.isInitializing,\n            peaksInstance = nextProps.peaksInstance,\n            segment = nextProps.segment;\n\n        if (initSegment && isInitializing) {\n          var startTime = initSegment.startTime,\n              endTime = initSegment.endTime;\n          return {\n            beginTime: structuralMetadataUtils.toHHmmss(startTime),\n            endTime: structuralMetadataUtils.toHHmmss(endTime),\n            isInitializing: false\n          };\n        }\n\n        if (prevState.peaksInstance !== peaksInstance && !isInitializing) {\n          var _waveformDataUtils$va = waveformDataUtils.validateSegment(segment, peaksInstance.peaks),\n              _startTime = _waveformDataUtils$va.startTime,\n              _endTime = _waveformDataUtils$va.endTime;\n\n          return {\n            beginTime: structuralMetadataUtils.toHHmmss(_startTime),\n            endTime: structuralMetadataUtils.toHHmmss(_endTime)\n          };\n        }\n      } // When handles in waveform is dragged disable typing in the input form\n\n\n      if (nextProps.isDragging) {\n        nextProps.setIsTyping(0);\n      }\n\n      return null;\n    }\n  }]);\n  return TimespanForm;\n}(_react.Component); // For testing purposes\n\n\nexports.PureTimespanForm = TimespanForm;\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    smData: state.smData,\n    peaksInstance: state.peaksInstance,\n    segment: state.peaksInstance.segment,\n    isDragging: state.peaksInstance.isDragging\n  };\n};\n\nvar mapDispatchToProps = {\n  updateSegment: peaksActions.updateSegment,\n  setIsDragging: peaksActions.dragSegment\n};\n\nvar _default = (0, _reactRedux.connect)(mapStateToProps, mapDispatchToProps)(TimespanForm);\n\nexports[\"default\"] = _default;","map":null,"metadata":{},"sourceType":"module"}