{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = exports.PureWaveformContainer = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));\n\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _Utils = _interopRequireDefault(require(\"../api/Utils\"));\n\nvar _reactRedux = require(\"react-redux\");\n\nvar _peaksInstance = require(\"../actions/peaks-instance\");\n\nvar _forms = require(\"../actions/forms\");\n\nvar _Waveform = _interopRequireDefault(require(\"../components/Waveform\"));\n\nvar _AlertContainer = _interopRequireDefault(require(\"../containers/AlertContainer\"));\n\nvar _alertStatus = require(\"../services/alert-status\");\n\nvar apiUtils = new _Utils[\"default\"](); // Peaks options\n\nvar peaksOptions = {\n  container: null,\n  mediaElement: null,\n  dataUri: null,\n  dataUriDefaultFormat: 'json',\n  keyboard: true,\n  pointMarkerColor: '#006eb0',\n  showPlayheadTime: true,\n  zoomWaveformColor: 'rgba(117, 117, 117, 1)',\n  overviewWaveformColor: 'rgba(117, 117, 117, 1)'\n};\n\nvar WaveformContainer =\n/*#__PURE__*/\nfunction (_Component) {\n  (0, _inherits2[\"default\"])(WaveformContainer, _Component);\n\n  function WaveformContainer(props) {\n    var _this;\n\n    (0, _classCallCheck2[\"default\"])(this, WaveformContainer);\n    _this = (0, _possibleConstructorReturn2[\"default\"])(this, (0, _getPrototypeOf2[\"default\"])(WaveformContainer).call(this, props));\n    (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"state\", {\n      alertObj: null,\n      hasError: false,\n      masterFileID: _this.props.masterFileID,\n      baseURL: _this.props.baseURL,\n      initStructure: _this.props.initStructure,\n      streamLength: _this.props.streamDuration\n    });\n    (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"clearAlert\", function () {\n      _this.setState({\n        alertObj: null\n      });\n    });\n    _this.waveformContainer = null;\n    _this.mediaPlayer = null;\n    return _this;\n  }\n\n  (0, _createClass2[\"default\"])(WaveformContainer, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      peaksOptions.container = this.waveformContainer;\n      peaksOptions.mediaElement = this.mediaPlayer;\n      this.initializePeaksInstance();\n    }\n  }, {\n    key: \"initializePeaksInstance\",\n    value: function () {\n      var _initializePeaksInstance = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee() {\n        var _this$state, baseURL, masterFileID, initStructure, streamLength, isError, response;\n\n        return _regenerator[\"default\"].wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _this$state = this.state, baseURL = _this$state.baseURL, masterFileID = _this$state.masterFileID, initStructure = _this$state.initStructure, streamLength = _this$state.streamLength;\n                isError = false;\n                _context.prev = 2;\n                _context.next = 5;\n                return apiUtils.getRequest(baseURL, masterFileID, 'waveform.json');\n\n              case 5:\n                response = _context.sent; // Set the masterfile URL as the URI for the waveform data file\n\n                peaksOptions.dataUri = response.request.responseURL; // Initialize Peaks\n\n                this.props.fetchDataAndBuildPeaks(baseURL, masterFileID, initStructure, peaksOptions, streamLength, isError); // Update redux-store flag for waveform file retrieval\n\n                this.props.retrieveWaveformSuccess();\n                _context.next = 17;\n                break;\n\n              case 11:\n                _context.prev = 11;\n                _context.t0 = _context[\"catch\"](2);\n                isError = true;\n                this.handleError(_context.t0); // Disable edting when waveform is missing\n\n                this.props.handleEditingTimespans(1); // Fetch structure.json when waveform.json is\n\n                this.props.fetchDataAndBuildPeaks(baseURL, masterFileID, initStructure, peaksOptions, streamLength, isError);\n\n              case 17:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[2, 11]]);\n      }));\n\n      function initializePeaksInstance() {\n        return _initializePeaksInstance.apply(this, arguments);\n      }\n\n      return initializePeaksInstance;\n    }()\n  }, {\n    key: \"handleError\",\n    value: function handleError(error) {\n      console.log('TCL: WaveformContainer -> handleError -> error', error);\n      var status = null; // Pull status code out of error response/request\n\n      if (error.response !== undefined) {\n        status = error.response.status;\n      } else if (error.request !== undefined) {\n        status = -3;\n      }\n\n      var alertObj = (0, _alertStatus.configureAlert)(status, this.clearAlert);\n      this.setState({\n        alertObj: alertObj,\n        hasError: true\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$state2 = this.state,\n          alertObj = _this$state2.alertObj,\n          hasError = _this$state2.hasError;\n      var _this$props = this.props,\n          forms = _this$props.forms,\n          audioStreamURL = _this$props.audioStreamURL;\n      return _react[\"default\"].createElement(\"section\", null, !forms.waveformRetrieved && hasError ? _react[\"default\"].createElement(_AlertContainer[\"default\"], alertObj) : _react[\"default\"].createElement(_Waveform[\"default\"], {\n        waveformRef: function waveformRef(ref) {\n          return _this2.waveformContainer = ref;\n        },\n        mediaPlayerRef: function mediaPlayerRef(ref) {\n          return _this2.mediaPlayer = ref;\n        },\n        audioStreamURL: audioStreamURL\n      }));\n    }\n  }]);\n  return WaveformContainer;\n}(_react.Component); // For testing purposes\n\n\nexports.PureWaveformContainer = WaveformContainer;\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    smData: state.smData,\n    forms: state.forms\n  };\n};\n\nvar mapDispatchToProps = {\n  fetchDataAndBuildPeaks: _peaksInstance.initializeSMDataPeaks,\n  retrieveWaveformSuccess: _forms.retrieveWaveformSuccess,\n  handleEditingTimespans: _forms.handleEditingTimespans\n};\n\nvar _default = (0, _reactRedux.connect)(mapStateToProps, mapDispatchToProps)(WaveformContainer);\n\nexports[\"default\"] = _default;","map":null,"metadata":{},"sourceType":"module"}